<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Josh's Awesome CPM Calculator</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <script>
      function calculateCost(gasPrice,
		       electricityPrice,
		       expectedLife,
		       cost,
		       miles,
		       mpg,
		       electric) {
    let remainingMiles = (expectedLife - miles)
	  let carCost = parseFloat(cost) / remainingMiles;
    if (electric) {
	return ((mpg * electricityPrice) + carCost).toFixed(4);
    } else {
	let gasCosts = (gasPrice / mpg)
	return (carCost + gasCosts).toFixed(4);
    }
      }

      function calculateTotalCost(gasPrice,
		       electricityPrice,
		       expectedLife,
		       cost,
		       miles,
		       mpg,
		       electric) {
	  let remainingMiles = (expectedLife - miles)
	  let carCost = parseFloat(cost);
	  if (electric) {
	      let total = ((mpg * electricityPrice * remainingMiles) + carCost).toFixed(2)
	return  total;
	  } else {
	      let gasCosts = (gasPrice / mpg) * remainingMiles;
	      console.log(typeof(gasCosts))
	      console.log(typeof(carCost))
	      let result = (carCost + gasCosts).toFixed(2);
	return result;
    }
}

function resolveNode(car) {
    // Globals
    let gasPrice = document.getElementById("gasprice").value
    let electricityPrice = document.getElementById("electricityprice").value
    let expectedLife = document.getElementById("expectedlife").value
    
    // Car Locals
    let nickname = car.querySelectorAll("input#nickname")[0].value;
    let cost = car.querySelectorAll("input#cost")[0].value;
    let miles = car.querySelectorAll("input#miles")[0].value;
    let mpg = car.querySelectorAll("input#mpg")[0].value;
    let electric = car.querySelectorAll("input#electric")[0].checked;
    console.log(electric)

    // Result
    let result = car.querySelectorAll("em#result")[0]
    let total = car.querySelectorAll("em#total")[0]
    
    result.innerHTML = calculateCost(gasPrice, electricityPrice, expectedLife, cost, miles, mpg, electric);
    total.innerHTML = calculateTotalCost(gasPrice, electricityPrice, expectedLife, cost, miles, mpg, electric);
    
    return calculateCost(gasPrice, electricityPrice, expectedLife, cost, miles, mpg, electric);
}

function update() {
    document.getElementsByName("car").forEach((car) => resolveNode(car)); 
}
    </script>
    <h1>Globals</h1>
     <label for="fname">Average Gas Price Over Lifetime:</label>
     <input type="number" id="gasprice" name="gasprice" value="4.00">
     <label for="fname">Energy Charge (per kWh)</label>
     <input type="number" id="electricityprice" name="electricityprice" value="0.136">
     <br>
     <label for="fname">Car Life (In Miles)</label>
     <input type="number" id="expectedlife" name="expectedlife" value=200000>
     <h1>Cars</h1>
     <a href="https://ecocostsavings.com/electric-car-kwh-per-mile-list/">KWH/Mile Report</a>
    <table id="cars">
      <tr>
	<th>Nickname</th>
	<th>Cost</th>
	<th>Miles</th>
	<th>MPG or kWh/mile</th>
	<th>Electric?</th>
	<th>CPM</th>
	<th>Total Cost</th>
      </tr>
      <tr name="car">
	<td><input type="text" id="nickname" name="nickname"></th>
	<td><input type="number" id="cost" name="cost"></th>
        <td><input type="number" id="miles" name="miles"></th>
	<td><input type="number" id="mpg" name="mpg"></th>
        <td><input type="checkbox" id="electric" name="electric"></th>
<td><em id="result"></em></td>
        <td><em id="total"></em></td>
</tr>
      <tr name="car">
	<td><input type="text" id="nickname" name="nickname"></th>
	<td><input type="number" id="cost" name="cost"></th>
        <td><input type="number" id="miles" name="miles"></th>
	<td><input type="number" id="mpg" name="mpg"></th>
        <td><input type="checkbox" id="electric" name="electric"></th>
      <td><em id="result"></em></td>
        <td><em id="total"></em></td>
</tr>
      <tr name="car">
	<td><input type="text" id="nickname" name="nickname"></th>
	<td><input type="number" id="cost" name="cost"></th>
        <td><input type="number" id="miles" name="miles"></th>
	<td><input type="number" id="mpg" name="mpg"></th>
        <td><input type="checkbox" id="electric" name="electric"></th>
      <td><em id="result"></em></td>
        <td><em id="total"></em></td>
</tr>

      <tr name="car">
	<td><input type="text" id="nickname" name="nickname"></th>
	<td><input type="number" id="cost" name="cost"></th>
        <td><input type="number" id="miles" name="miles"></th>
	<td><input type="number" id="mpg" name="mpg"></th>
        <td><input type="checkbox" id="electric" name="electric"></th>
      <td><em id="result"></em></td>
        <td><em id="total"></em></td>
</tr>

      <tr name="car">
	<td><input type="text" id="nickname" name="nickname"></th>
	<td><input type="number" id="cost" name="cost"></th>
        <td><input type="number" id="miles" name="miles"></th>
	<td><input type="number" id="mpg" name="mpg"></th>
        <td><input type="checkbox" id="electric" name="electric"></th>
      <td><em id="result"></em></td>
        <td><em id="total"></em></td>
</tr>
      <tr name="car">
	<td><input type="text" id="nickname" name="nickname"></th>
	<td><input type="number" id="cost" name="cost"></th>
        <td><input type="number" id="miles" name="miles"></th>
	<td><input type="number" id="mpg" name="mpg"></th>
        <td><input type="checkbox" id="electric" name="electric"></th>
      <td><em id="result"></em></td>
        <td><em id="total"></em></td>
</tr>
      <tr name="car">
	<td><input type="text" id="nickname" name="nickname"></th>
	<td><input type="number" id="cost" name="cost"></th>
        <td><input type="number" id="miles" name="miles"></th>
	<td><input type="number" id="mpg" name="mpg"></th>
        <td><input type="checkbox" id="electric" name="electric"></th>
      <td><em id="result"></em></td>
        <td><em id="total"></em></td>
</tr>
      <tr name="car">
	<td><input type="text" id="nickname" name="nickname"></th>
	<td><input type="number" id="cost" name="cost"></th>
        <td><input type="number" id="miles" name="miles"></th>
	<td><input type="number" id="mpg" name="mpg"></th>
        <td><input type="checkbox" id="electric" name="electric"></th>
      <td><em id="result"></em></td>
        <td><em id="total"></em></td>
</tr>
      <tr name="car">
	<td><input type="text" id="nickname" name="nickname"></th>
	<td><input type="number" id="cost" name="cost"></th>
        <td><input type="number" id="miles" name="miles"></th>
	<td><input type="number" id="mpg" name="mpg"></th>
        <td><input type="checkbox" id="electric" name="electric"></th>
      <td><em id="result"></em></td>
        <td><em id="total"></em></td>
</tr>


</table>
<button onClick="update()">recalculate</button>
  </body>
</html>
